"use strict";var prefix="/",path="api/v1/activity/worldcup/",uuid,reqUrl="../api.json",voteTeam,cards={date_1:[],date_2:[],date_3:[],date_4:[],date_5:[]},date=new Date,day=date.getDate(),dateString_1=void 0,dateString_2=void 0,dateString_3=void 0,dateString_4=void 0,dateString_5=void 0,ajaxGet=function(t,e,a){$.ajax({type:"GET",url:t,dataType:"json"}).done(function(t,a,r){e(t)}).fail(function(t,e,r){a(r)})},ajaxPost=function(t,e,a,r){$.ajax({type:"POST",url:t,contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:e}).done(function(t,e,r){a(t)}).fail(function(t,e,a){r(a)})},createHtmlP=function(t){var e=arguments.length<=1||void 0===arguments[1]?void 0:arguments[1];if(void 0===e)return $("<p>"+t+"</p>");var a="";for(var r in e)a=a+r+":"+e[r]+";";return $('<p style="'+a+'">'+t+"</p>")},createHtmlImg=function(t,e){return $('<img alt="'+e+'" src="'+t+'" />')},createHtmlButton=function(t,e,a,r){if(r){var n=$('<button data-team="'+e+'" data-uuid="'+a+'">已结束</button>');return n.attr("disabled","disabled"),n.css("background-color","#95a5a6"),n}return $('<button data-team="'+e+'" data-uuid="'+a+'">'+t+"</button>")},createHtmlDiv=function(t,e){for(var a=$('<div class="'+e+'"></div>'),r=0;r<t.length;r++)t[r].appendTo(a);return a},createHtmlGameCard=function(t,e,a,r,n,d,i,o,g){var s=createHtmlP(e),l=createHtmlImg(a,"hostFLag"),c=createHtmlButton("点击投票",t,o,g),u=createHtmlP(n),S=createHtmlImg(d,"guestFLag"),m=createHtmlButton("点击投票",r,o,g),h=createHtmlDiv([s,l,c],"page0-gamecard-left"),p=createHtmlDiv([createHtmlP("vs"),createHtmlP(i)],"page0-gamecard-mid"),f=createHtmlDiv([u,S,m],"page0-gamecard-right"),_=createHtmlDiv([h,p,f],"page0-timetable-game");return _},addGameCardsOnOneDayInHtml=function(t){for(var e in t)t[e].addClass("animated flipInX"),$(".page0-timetable").append(t[e]);$(".page0-timetable-game button").on("click",function(t){t.preventDefault(),voteTeam=this.dataset.team,uuid=this.dataset.uuid,$("#myModal").modal("show")})},removeGameCardsOnOneDayInHtml=function(t){for(var e in t)t[e].removeClass("flipInX"),t[e].remove()},preloadFiles=function(){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href="/css/uefa.css";var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href="/css/animate.min.css";var a=document.createElement("script");a.type="text/javascript",a.src="/js/bootstrap.min.js",$("head").first().append(e),$("head").first().append(t),$("html").first().append(a),$("#football").append(createHtmlImg("//ooo.0o0.ooo/2016/06/15/57622df0744e3.png","football")),$("#logo").append(createHtmlImg("//ooo.0o0.ooo/2016/06/15/57622884e73bb.png","logo"))},getInfo=function(t){preloadFiles(),changeProgressBarValue(70),$("#date_1").text(dateString_1.substring(5)),$("#date_2").text(dateString_2.substring(5)),$("#date_3").text(dateString_3.substring(5)),$("#date_4").text(dateString_4.substring(5)),$("#date_5").text(dateString_5.substring(5)),$("#modal-close").attr("href",t.data.races[0].register_url),$("title").first().text(t.data.title);for(var e=0;e<t.data.races.length;e++){var a=t.data.races[e],r=a.meta.expired,n=createHtmlGameCard(a.host.name,a.host.nameCN,a.host.flag,a.guest.name,a.guest.nameCN,a.guest.flag,a.meta.startAt.split(" ")[1].substring(0,5),a.uuid,r);switch(t.data.races[e].meta.startAt.split(" ")[0]){case dateString_1:cards.date_1.push(n);break;case dateString_2:cards.date_2.push(n);break;case dateString_3:cards.date_3.push(n);break;case dateString_4:cards.date_4.push(n);break;case dateString_5:cards.date_5.push(n)}}for(var e in cards)0==cards[e].length&&cards[e].push(createHtmlP("无赛事",{width:"100%",color:"#fff","font-size":"2rem","text-align":"center"}));addGameCardsOnOneDayInHtml(cards.date_3),changeProgressBarValue(100),window.setTimeout(function(){loadEnd()},1e3)},postPhoneNumber=function(t){if(void 0===t.errcode)$("#wrongMsg").text("参与成功！"),$("#wrongMsg").css("display","block"),window.setTimeout(function(){$("#wrongMsg").css("display","none"),$("#myModal").modal("hide")},2e3),$(".page0-timetable-game button").each(function(t){this.dataset.uuid===uuid&&($(this).attr("disabled","disabled"),voteTeam===this.dataset.team?$(this).css("background-color","#e74c3c"):$(this).css("background-color","#95a5a6"),$(this).text("已投票"))});else{var e;switch(t.errcode){case 400717:e="投票已截止！";break;case 400718:e="发生错误，请重新输入！";break;case 400719:e="手机号码错误！";break;case 400720:e="发生错误，请重新输入！";break;case 400721:e="此手机号已投过票了哦！";break;default:e="发生未知错误，请重新输入！"}console.log(e)}},handleAjaxFail=function(t){},loadEnd=function(){$(".progress-wrapper").css("display","none"),$(".container-wrapper").css("display","block")},changeProgressBarValue=function(t){var e=t.toString();$(".progress-bar").attr("aria-valuenow",e),$(".progress-bar").css("width",e+"%")};$(function(){switch(ajaxGet(prefix+path,getInfo,handleAjaxFail),day){case 29:dateString_1=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-2).toString(),dateString_2=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-1).toString(),dateString_3=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+day.toString(),dateString_4=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+1).toString(),dateString_5=date.getFullYear().toString()+"-"+(date.getMonth()+2).toString()+"-1";break;case 30:dateString_1=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-2).toString(),dateString_2=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-1).toString(),dateString_3=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+day.toString(),dateString_4=date.getFullYear().toString()+"-"+(date.getMonth()+2).toString()+"-1",dateString_5=date.getFullYear().toString()+"-"+(date.getMonth()+2).toString()+"-2";break;case 1:dateString_1=date.getFullYear().toString()+"-"+date.getMonth().toString()+"-29",dateString_2=date.getFullYear().toString()+"-"+date.getMonth().toString()+"-30",dateString_3=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+day.toString(),dateString_4=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+1).toString(),dateString_5=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+2).toString();break;case 2:dateString_1=date.getFullYear().toString()+"-"+date.getMonth().toString()+"-30",dateString_2=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-1).toString(),dateString_3=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+day.toString(),dateString_4=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+1).toString(),dateString_5=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+2).toString();break;default:dateString_1=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-2).toString(),dateString_2=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day-1).toString(),dateString_3=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+day.toString(),dateString_4=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+1).toString(),dateString_5=date.getFullYear().toString()+"-"+(date.getMonth()+1).toString()+"-"+(day+2).toString()}$(".page0-date").on("click",function(t){t.preventDefault(),$(".page0-date").each(function(){$(this).hasClass("active-date")&&(removeGameCardsOnOneDayInHtml(cards[$(this).attr("id")]),$(this).removeClass("active-date"))}),$(this).addClass("active-date"),addGameCardsOnOneDayInHtml(cards[$(this).attr("id")])}),$("#join").on("click",function(t){t.preventDefault();var e=$("#userPhoneInput").val(),a=new RegExp("(^(13\\d|15[^4,\\D]|17[13678]|18\\d)\\d{8}|170[^346,\\D]\\d{7})$","g");a.test(e)?ajaxPost(prefix+path+uuid+"/","phone="+e+"&team="+voteTeam,postPhoneNumber,handleAjaxFail):($("#wrongMsg").text("手机号有误，请重试！"),$("#wrongMsg").css("display","block"))})});